{% load static %}
<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <meta name="description" content="">
        <meta name="author" content="">

        <title>Together Culture</title>

        <!-- CSS FILES -->                
        <link rel="preconnect" href="https://fonts.googleapis.com">

        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

        <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,700;1,400&display=swap" rel="stylesheet">

        <link href="{% static 'togCul/css/bootstrap.min.css' %}" rel="stylesheet">

        <link href="{% static 'togCul/css/bootstrap-icons.css' %}" rel="stylesheet">

        <link href="{% static 'togCul/css/templatemo-tiya-golf-club.css' %}" rel="stylesheet">
        <style>
            .modal {
                z-index: 1050 !important; /* Ensure the modal is on top */
            }
            .modal-backdrop {
                z-index: 1040 !important; /* Ensure the backdrop is below the modal */
            }
        </style>
        
<!--

TemplateMo 587 Tiya Golf Club

https://templatemo.com/tm-587-tiya-golf-club

-->
    </head>
    
    <body>

        <main>

            <nav class="navbar navbar-expand-lg">                
                <div class="container">
                    <a class="navbar-brand d-flex align-items-center" href="index.html">
                        <img src="{% static 'togCul/images/logo.png' %}" class="navbar-brand-image img-fluid" alt="Tiya Golf Club">
                    </a>

                    <div class="d-lg-none ms-auto me-3">
                        <a class="btn custom-btn custom-border-btn" data-bs-toggle="offcanvas" href="#TogetherCulture" role="button" aria-controls="TogetherCulture">Member Login</a>
                    </div>
    
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
    
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav ms-lg-auto">
    
                            <li class="nav-item">
                                <a class="nav-link click-scroll" href="#section_2">Members</a>
                            </li>
                                <li><a class="dropdown-item" href="{% url 'DigitalContent' %}">Digital Content</a></li>
                            <li class="nav-item">
                                <a class="nav-link click-scroll" href="#section_3">Add Events</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link click-scroll" href="#section_4">Member Benifits</a>
                            </li>
                        </ul>

                        <div class="d-none d-lg-block ms-lg-3">
                            <a id = "LogoutBtn" href="{% url 'Admin' %}" onclick="window.location.href=this.href; return false;" class="btn custom-btn custom-border-btn" data-bs-toggle="offcanvas" href="" role="button" aria-controls="offcanvasExample">Log out</a>
                        </div>
                    </div>
                </div>

            </nav>
            

            <section class="hero-section hero-50 d-flex justify-content-center align-items-center" id="section_1">

                <div class="section-overlay"></div>

                <svg viewBox="0 0 1962 178" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path fill="#3D405B" d="M 0 114 C 118.5 114 118.5 167 237 167 L 237 167 L 237 0 L 0 0 Z" stroke-width="0"></path> <path fill="#3D405B" d="M 236 167 C 373 167 373 128 510 128 L 510 128 L 510 0 L 236 0 Z" stroke-width="0"></path> <path fill="#3D405B" d="M 509 128 C 607 128 607 153 705 153 L 705 153 L 705 0 L 509 0 Z" stroke-width="0"></path><path fill="#3D405B" d="M 704 153 C 812 153 812 113 920 113 L 920 113 L 920 0 L 704 0 Z" stroke-width="0"></path><path fill="#3D405B" d="M 919 113 C 1048.5 113 1048.5 148 1178 148 L 1178 148 L 1178 0 L 919 0 Z" stroke-width="0"></path><path fill="#3D405B" d="M 1177 148 C 1359.5 148 1359.5 129 1542 129 L 1542 129 L 1542 0 L 1177 0 Z" stroke-width="0"></path><path fill="#3D405B" d="M 1541 129 C 1751.5 129 1751.5 138 1962 138 L 1962 138 L 1962 0 L 1541 0 Z" stroke-width="0"></path></svg>

                <div class="container">
                    <div class="row">

                    </div>
                </div>
            </section>


            <section class="events-section section-padding" id="section_2">
                <div class="container">
                    <div class="row">

                        <div class="col-lg-12 col-12">
                            <h2 class="mb-lg-5 mb-4" >Our Members</h2>
                        </div>
                        <table>
                            <tbody>
                                <tr>
                                    <td><div class="col-lg-5 col-12 mx-auto">                        
                                        <form action="" method="post" class="custom-form membership-form shadow-lg" role="form">
                                            {% csrf_token %}
                                            <h4 class="text-white mb-4"> Total members</h4>
                                            <h4 class="text-white mb-4"> {{ Total_Members }} </h4>
                                            </div>
                                        </form>
                                    </div>
                                    <br/>
                                </td>
                                <br/>
                                </tr>
                                {% for user in Pending_Users %}
                                <tr>
                                    <td>
                                        <form action="{% url 'process_membership' user.email %}" method="post" style="display:inline;">
                                            {% csrf_token %}
                                            <label style="padding: 10px;  " > <b>Name: </b> {{ user.full_name }}<label/> 
                                            <label style="padding: 10px; " > <b>email: </b> {{ user.email}}<label/>
                                            <br/>
                                            <button type="submit" name="action" value="approve" style="padding: 10px;" >Approve</button>
                                            <button type="submit" name="action" value="reject" style="padding: 10px;" >Reject</button>
                                        </form>
                                    </td>
                                <tr/>
                                {% endfor%}
                            </tbody>
                        </table>
                        
                        <br/>
                        

                    </div>
                </div>
            </section>


        


        </div>
        <section class="events-section section-padding" id="section_2">
            <div class="container">
                <div class="row">
                 
        
                    <!-- Search Form -->
                    <div class="col-lg-6 col-12 mb-4">
                        <form method="get" action="{% url 'search_members' %}" class="d-flex">
                            <input type="text" name="query" class="form-control me-2" placeholder="Search members by name or email" required>
                            <button type="submit" class="btn btn-primary">Search</button>
                        </form>
                    </div>
        
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Membership Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in members %}
                            <tr>
                                <td>{{ user.full_name }}</td>
                                <td>{{ user.email }}</td>
                                <td>{{ user.get_membershipStatus_display }}</td>
                               
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4">No members found.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </div>
</section>

            <section class="events-section events-listing-section section-bg section-padding" id="section_3">
                <div class="container">
                    <div class="row">
                    
                        <div class="col-lg-5 col-12 mx-auto">
                            <h2 class="mb-3">Add Events</h2>
                            <div class="custom-form membership-form shadow-lg">
                                <label for="event_name">Event Name:</label>
                                <input type="text" id="event_name" name="event_name" placeholder="Enter Event Name" required class="form-control mb-3">
                        
                                <label for="description">Event Description:</label>
                                <textarea id="description" name="description" placeholder="Enter Event Description" required class="form-control mb-3"></textarea>
                        
                                <button type="button" id="add_event_button" class="btn btn-primary">Add Event</button>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
            </section>
            <section class="events-section section-padding" id="section_4">
                <div class="container">
                    <div class="row">

                        <div class="col-lg-12 col-12">
                            <h2 class="mb-lg-5 mb-4">Member Benifits</h2>
                        </div>

                    </div>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="#3D405B" fill-opacity="1" d="M0,224L34.3,192C68.6,160,137,96,206,90.7C274.3,85,343,139,411,144C480,149,549,107,617,122.7C685.7,139,754,213,823,240C891.4,267,960,245,1029,224C1097.1,203,1166,181,1234,160C1302.9,139,1371,117,1406,106.7L1440,96L1440,320L1405.7,320C1371.4,320,1303,320,1234,320C1165.7,320,1097,320,1029,320C960,320,891,320,823,320C754.3,320,686,320,617,320C548.6,320,480,320,411,320C342.9,320,274,320,206,320C137.1,320,69,320,34,320L0,320Z"></path></svg>
            </section>
            
<!-- Confirmation Modal -->
<div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmationModalLabel">Confirm Event Addition</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to add this event?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" id="confirm_add_event" class="btn btn-primary">Confirm</button>
            </div>
        </div>
    </div>
</div>

<!-- Success Modal -->
<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="successModalLabel">Success</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Event added successfully!
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>
        </main>

        <!-- JAVASCRIPT FILES -->
        <script src="{% static 'togCul/js/jquery.min.js' %}"></script>
        <script src="{% static 'togCul/js/bootstrap.bundle.min.js' %}"></script>
        <script src="{% static 'togCul/js/jquery.sticky.js' %}"></script>
        <script src="{% static 'togCul/js/custom.js' %}"></script>
<script>
    // Get references to the modals and buttons
    const addEventButton = document.getElementById('add_event_button');
const confirmAddEventButton = document.getElementById('confirm_add_event');
const confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModal'));
const successModal = new bootstrap.Modal(document.getElementById('successModal'));

// Add event listener for the "Add Event" button
addEventButton.addEventListener('click', function () {
    // Get the values from the input fields
    const eventName = document.getElementById('event_name').value.trim();
    const eventDescription = document.getElementById('description').value.trim();

    // Check if the fields are not empty
    if (!eventName || !eventDescription) {
        alert('Please fill in both the Event Name and Event Description.');
        return;
    }

    // Show the confirmation modal
    confirmationModal.show();

    // Store the event data in the button's dataset for later use
    confirmAddEventButton.dataset.eventName = eventName;
    confirmAddEventButton.dataset.eventDescription = eventDescription;
});

// Add event listener for the "Confirm" button (attach only once)
confirmAddEventButton.addEventListener('click', function () {
    // Hide the confirmation modal
    confirmationModal.hide();

    // Retrieve the event data from the button's dataset
    const eventName = this.dataset.eventName;
    const eventDescription = this.dataset.eventDescription;

    // Send the data to the API endpoint
    fetch('/api/add-event/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value // Include CSRF token
        },
        body: JSON.stringify({
            event_name: eventName,
            description: eventDescription
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.message) {
            // Show the success modal
            successModal.show();

            // Clear the input fields
            document.getElementById('event_name').value = '';
            document.getElementById('description').value = '';
        } else if (data.error) {
            alert(data.error); // Show error message
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while adding the event.');
    });
});
</script>
    </body>
</html>
